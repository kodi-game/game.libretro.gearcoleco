From 965d4fccc301c402b72d2bfdac799d59776be78b Mon Sep 17 00:00:00 2001
From: Garrett Brown <themagnificentmrb@gmail.com>
Date: Sun, 1 Sep 2024 16:55:47 -0700
Subject: [PATCH] Use latest git tag instead of git hash

We force GIT_VERSION to "" in the CMakeLists.txt file.
---
 platforms/libretro/Makefile | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/platforms/libretro/Makefile b/platforms/libretro/Makefile
index 01db018..cf399fe 100644
--- a/platforms/libretro/Makefile
+++ b/platforms/libretro/Makefile
@@ -325,6 +325,14 @@ endif
 GIT_VERSION ?= " $(shell git describe --abbrev=7 --dirty --always --tags || echo unknown)"
 ifneq ($(GIT_VERSION)," unknown")
    CXXFLAGS += -DEMULATOR_BUILD=\"$(GIT_VERSION)\"
+   CXXFLAGS += -DEMULATOR_BUILD=\"$(shell \
+      if git rev-parse --is-shallow-repository > /dev/null 2>&1; then \
+         git fetch --unshallow --tags origin main > /dev/null 2>&1; \
+      else \
+         git fetch --tags origin main > /dev/null 2>&1; \
+      fi; \
+      git describe --tags --abbrev=0 --always \
+   )"
 endif
 
 include Makefile.common
-- 
2.34.1

